<html>
    <head>
        <title>Apache Qpid : Sustained Tests</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            Apache Qpid : Sustained Tests
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Jun 27, 2007 by <font color="#0050B2">ritchiem</font>.
				    </div>

				    <h2><a name="SustainedTests-Pub%2FSubSustainedTests"></a>Pub/Sub Sustained Tests</h2>

<p>We currently have one sustained test for pub / sub messaging. The test is based on the interop testing framework and as such there are two classes that are involve.</p>

<ol>
	<li>org.apache.qpid.sustained.TestClient</li>
	<li>org.apache.qpid.sustained.TestCoordinator</li>
</ol>


<p>As with the Interop Tests the Test Coordinator collects various clients to work on the specified test. The sustained test suit currently only has one test which is the SustainedTestClient. </p>

<h3><a name="SustainedTests-SustainedTestClientTest"></a>SustainedTestClient Test</h3>

<p>This test is a pub/sub test. There is a single publisher that sends batches of messages to a known topic. The clients then receive these messages and report the time required to retrive all of the batch. This reported time is sent to the publisher so that it can adjust its publication rate to ensure that messages are sent at a rate that all clients can maintain.</p>

<h4><a name="SustainedTests-Usage"></a>Usage</h4>
<p>The coordinator can take a number of parameters.</p>

<ul class="alternate" type="square">
	<li>numReceives (Default : 2)<br/>
This is the number of receivers each client node should create</li>
	<li>batchSize (Default : 1000)<br/>
This is the number of messages to send per batch</li>
	<li>ackMode (Default : 1 - AUTO_ACK )<br/>
The acknowledgement mode to use. Currently No_ack (257) appears not to work correctly.</li>
</ul>



<p>The client can take the following system parameters (set via -D properties)<br/>
(These values should be moved to the Coordinator so that you do not need to guess which client will become the sender as these values are only of use to the sending client.)</p>

<ul class="alternate" type="square">
	<li>sleepPerMessage (Default : false)<br/>
Divides the current _delay value into small sleeps between messages. Useful if your Thread.sleep implementation works at the nanosecond level. Under windows the smallest sleep value is around 10ms.</li>
	<li>warmUpBatches (Default : 10)<br/>
Adjusts the number of batches sent before resetting the delay calculations.</li>
	<li>stableReportCount (Default : 5)<br/>
The number of reports that need to arrive without changing the delay before reporting the delay is stable.</li>
	<li>batchVariance (Default : 3)<br/>
The difference between the batch number sent and the received batch number.</li>
</ul>


<p>The client also has one additional parameter. </p>

<ul class="alternate" type="square">
	<li>"-j" can be used to join an existing test run. Dispite there being only one test case at present this class must be provided as future sustained test classes may be available.
<div class="preformatted"><div class="preformattedContent">
<pre>java -cp &lt;qpid.jar&gt; org.apache.qpid.sustained.TestClient -n client2 -j org.apache.qpid.performance.sustainedrate.SustainedTestClient
</pre>
</div></div></li>
</ul>


<p>It is important to remember that each cilent must be uniquly named for the test to accurately work. This can be done by ensuring that all clients specify a unique "-n" value. So running</p>
<div class="preformatted"><div class="preformattedContent">
<pre>java -cp &lt;qpid.jar&gt; org.apache.qpid.sustained.TestClient -n client2 
</pre>
</div></div>

<p>Will correctly name the client 'client2' and attempt to joint the client to any running SustainedTestClient test. If there is no test running then the client will simply wait for the test to start.</p>

				    
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="border/border_bottom.gif"><img src="border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Apr 22, 2008 02:47</font></td>
		    </tr>
	    </table>
    </body>
</html>