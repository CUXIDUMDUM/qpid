<!DOCTYPE HTML>
<!--
 -
 - Licensed to the Apache Software Foundation (ASF) under one
 - or more contributor license agreements.  See the NOTICE file
 - distributed with this work for additional information
 - regarding copyright ownership.  The ASF licenses this file
 - to you under the Apache License, Version 2.0 (the
 - "License"); you may not use this file except in compliance
 - with the License.  You may obtain a copy of the License at
 -
 -   http://www.apache.org/licenses/LICENSE-2.0
 -
 - Unless required by applicable law or agreed to in writing,
 - software distributed under the License is distributed on an
 - "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 - KIND, either express or implied.  See the License for the
 - specific language governing permissions and limitations
 - under the License.
 -
 -->
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Virtual Host</title>
		<!--<link rel="stylesheet" href="/dojo/1.7.2/dojo/resources/dojo.css">
		<link rel="stylesheet" href="/dojo/1.7.2/dijit/themes/claro/claro.css">
		<link rel="stylesheet" href="/dojo/1.7.2/dojox/grid/resources/claroGrid.css">-->
        <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/dojo/1.7.1/dojo/resources/dojo.css">
        <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/dojo/1.7.1/dijit/themes/claro/claro.css">
        <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/dojo/1.7.1/dojox/grid/resources/claroGrid.css">

        <link rel="stylesheet" href="../css/vhost.css" media="screen">

		<link rel="stylesheet" href="css/common.css" media="screen">

        <!-- load dojo and provide config via data attribute
         style="height: 800px"-->
		<!--<script src="/dojo/1.7.2/dojo/dojo.js.uncompressed.js" data-dojo-config="async: true, parseOnLoad: true">
        </script>                                                                                 -->

        <script src="http://ajax.googleapis.com/ajax/libs/dojo/1.7.1/dojo/dojo.js"
                data-dojo-config="async: true, parseOnLoad: true">
        </script>


            <script>
                require(["dijit/layout/BorderContainer", "dijit/layout/TabContainer", "dijit/layout/ContentPane",
                "dijit/TitlePane", "dojo/parser"]);
            </script>

        <script src="/js/common.js"></script>
        <script src="/js/vhost.js"></script>
        <script src="/js/sasl.js"></script>
        <script src="/js/header.js"></script>
        <script src="/js/footer.js"></script>
        <script src="/js/structure.js"></script>

        <script>
            require(["dojo/parser",
            /* dojox/ validate resources */
            "dojox/validate/us", "dojox/validate/web",
            /* basic dijit classes */
            "dijit/form/CheckBox", "dijit/form/Textarea", "dijit/form/FilteringSelect", "dijit/form/TextBox", "dijit/form/ValidationTextBox", "dijit/form/DateTextBox", "dijit/form/TimeTextBox", "dijit/form/Button", "dijit/form/RadioButton", "dijit/form/Form", "dijit/form/DateTextBox",
            /* basic dojox classes */
            "dojox/form/BusyButton", "dojox/form/CheckedMultiSelect", "dojo/domReady!"]);

            // Require the Dialog class
            require(["dijit/registry", "dijit/Dialog"], function(registry) {
                // Show the dialog
                addExchangeDialog = function() {
                    registry.byId("addExchange").show();
                }
                // Hide the dialog
                hideAddExchange = function() {
                    registry.byId("addExchange").hide();
                }


                var urlQuery = dojo.queryToObject(dojo.doc.location.search.substr((dojo.doc.location.search[0] === "?" ? 1 : 0)));

                new Header("Virtual Host: "+urlQuery.vhost);
            });
        </script>
	</head>
	<body class="claro">


    <div id="pageLayout" data-dojo-type="dijit.layout.BorderContainer" data-dojo-props="design: 'headline', gutters: false">
        <div data-dojo-type="dijit.layout.ContentPane" data-dojo-props="region:'top'"><div id="header" class="header"></div>
        </div>
        <div data-dojo-type="dijit.layout.ContentPane" data-dojo-props="region:'top'">
            <div id="login"></div>
        </div>
        <div data-dojo-type="dijit.layout.ContentPane" data-dojo-props="region:'leading', splitter: true">
                    <div id="structure"></div>
        </div>
        <div data-dojo-type="dijit.layout.ContentPane" data-dojo-props="region:'center'">
            <span style="">Name:</span><span id="name" style="position:absolute; left:6em"></span>
            <br/>
            <span style="">State:</span><span id="state" style="position:absolute; left:6em"></span>
            <br/>
            <span style="">Durable:</span><span id="durable" style="position:absolute; left:6em"></span>
            <span style="position:absolute; left:26em">Inbound:</span>
            <span id="msgInRate" style="position:absolute; right:9.5em"></span>
            <span style="position:absolute; right: 5em; width: 4em"> msg/s</span>
            <span id="bytesInRate" style="position:absolute; right: 3.3em"></span>
            <span id="bytesInRateUnits" style="position:absolute; right: 0em; width: 3em"></span>
            <br/>
            <span style="">Lifespan:</span><span style="position:absolute; left:6em" id="lifetimePolicy"></span>
            <span style="position:absolute; left:26em">Outbound:</span>
            <span id="msgOutRate" style="position:absolute; right:9.5em"></span>
            <span style="position:absolute; right: 5em; width: 4em"> msg/s</span>
            <span id="bytesOutRate" style="position:absolute; right: 3.3em"></span>
            <span id="bytesOutRateUnits" style="position:absolute; right: 0em; width: 3em"></span>
            <br/>
            <br/>
            <div data-dojo-type="dijit.TitlePane" data-dojo-props="title: 'Exchanges'">
                <div id="exchanges"></div>
                <br/>
                <button onclick="addExchangeDialog();">Add Exchange</button>

                <div class="dijitHidden">
                    <div data-dojo-type="dijit.Dialog" style="width:600px;" data-dojo-props="title:'Add Exchange'" id="addExchange">
                        <h1>Add a new Exchange</h1>
                        <br/>
                        <form dojoType="dijit.form.Form" method="post">
                        <script type="dojo/method" event="onSubmit">
                            if(this.validate())
                            {
                                var exchangeData = {};
                                exchangeData.name = dojo.byId("addExchangeName").value;
                                exchangeData.type = dijit.byId("addExchangeType").get('value');
                                exchangeData.durable = dojo.byId("addExchangeDurable").checked;
                                exchangeData.lifetimePolicy = dijit.byId("addExchangeLifetimePolicy").get('value');


                                var urlQuery = dojo.queryToObject(dojo.doc.location.search.substr((dojo.doc.location.search[0] === "?" ? 1 : 0)));
                                var postUrl = "/rest/exchange/" + urlQuery.vhost + "/" + exchangeData.name;


                                dojo.xhrPut( { url: "/rest/exchange/" + urlQuery.vhost + "/" + exchangeData.name,
                                             handleAs: "json",
                                             headers: { "Content-Type": "application/json"},
                                             putData: dojo.toJson( exchangeData )
                                            }).then( function(data)
                                                    {
                                                        hideAddExchange();
                                                    },
                                                    function(error)
                                                    {
                                                        alert(error);
                                                    }
                                                  );
                                return false;
                            }
                            else
                            {
                                alert('Form contains invalid data.  Please correct first');
                                return false;
                            }
                            return false;
                        </script>
                        <table cellpadding="0" cellspacing="2">
                            <tr>
                                <td valign="top"><strong>Name: </strong></td>
                                <td><input type="text" required="true" name="name" id="addExchangeName" placeholder="Exchange Name"
                                           dojoType="dijit.form.ValidationTextBox"/></td>
                            </tr>
                            <tr>
                                <td valign="top"><strong>Type: </strong></td>
                                <td>
                                    <select name="type" id="addExchangeType" dojoType="dijit.form.FilteringSelect">
                                        <option value="direct">direct</option>
                                        <option value="topic">topic</option>
                                        <option value="headers">headers</option>
                                        <option value="fanout">fanout</option>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td valign="top"><strong>Durable? </strong></td>
                                <td><input type="checkbox" name="durable" id="addExchangeDurable" dojoType="dijit.form.CheckBox" /></td>
                            </tr>
                            <tr>
                                <td valign="top"><strong>Lifetime Policy: </strong></td>
                                <td>
                                    <select name="lifetimePolicy" id="addExchangeLifetimePolicy" dojoType="dijit.form.FilteringSelect">
                                        <option value="PERMANENT">permanent</option>
                                        <option value="AUTO_DELETE">auto-delete</option>
                                    </select>
                                </td>
                            </tr>
                        </table>
                        <br/>
                        <input type="submit" value="Submit Form" id="addExchangeOk" dojoType="dojox.form.BusyButton"
                               label="Add" busyLabel="Submitting Form..." timeout="2000" />
                        <input type="button" value="Cancel" label="Cancel" id="addExchangeCancel" data-dojo-props="onClick:hideAddExchange" dojoType="dijit.form.Button" />

                        </form>

                    </div>
                </div>
            </div>
            <br/>
            <div data-dojo-type="dijit.TitlePane" data-dojo-props="title: 'Queues'">
                <div id="queues"></div>
            </div>
            <br/>
            <div data-dojo-type="dijit.TitlePane" data-dojo-props="title: 'Connections'">
                <div id="connections"></div>
            </div>
            <br/>
            <div data-dojo-type="dijit.TitlePane" data-dojo-props="title: 'Alerting Thresholds'">
                <span style="">Max. Queue Size:</span>
                <span id="alertThresholdQueueDepthMessages"
                      style="position:absolute; left:8em; width:8em; text-align:right"></span>
                <span style="position:absolute; left:16.2em">msgs</span>

                <span id="alertThresholdQueueDepthBytes"
                      style="position:absolute; left:20em; width:8em; text-align:right"></span>
                <span id="alertThresholdQueueDepthBytesUnits" style="position:absolute; left:28.2em"></span>
                <br>
                <span style="">Max. Message Age:</span>
                <span id="alertThresholdMessageAge"
                      style="position:absolute; left:8em; width:8em; text-align:right"></span>
                <span id="alertThresholdMessageAgeUnits" style="position:absolute; left:16.2em"></span>

                <span style="position:absolute; left:21em">Size: </span>
                <span id="alertThresholdMessageSize"
                      style="position:absolute; left:23em; width:5em; text-align:right"></span>
                <span id="alertThresholdMessageSizeUnits" style="position:absolute; left:28.2em"></span>
                <br/>
                <br/>
                <span style="">Alert frequency:</span>
                <span id="alertRepeatGap"
                      style="position:absolute; left:8em; width:8em; text-align:right"></span>
                <span id="alertRepeatGapUnits" style="position:absolute; left:16.2em"></span>



            </div>
        </div>
        <!--<div data-dojo-type="dijit.layout.ContentPane" data-dojo-props="region:'trailing'">Trailing pane</div>-->
        <div data-dojo-type="dijit.layout.ContentPane" data-dojo-props="region:'bottom'"><div id="footer"></div></div>
    </div>

	</body>
</html>

